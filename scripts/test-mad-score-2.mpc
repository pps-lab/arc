def compute_median(X_arr):
    X_copy = Array(X_arr.length, X_arr.value_type)
    X_copy.assign(X_arr)
    X_copy.sort()
    the_median = 0
    if X_arr.length % 2 == 0:
        the_median = (X_copy[(X_copy.length-1)//2] + X_copy[X_copy.length//2])/2
    else:
        the_median = X_copy[X_copy.length//2]
    return the_median

def compute_abs_diff_value(X_arr, the_val):
    X_copy = Array(X_arr.length, X_arr.value_type)
    @for_range(start=0,stop=X_arr.length,step=1)
    def _(i):
        X_copy[i] = abs(X_arr[i] - the_val)
    return X_copy

# We expect an Array
def MAD_Score(X_array):
    score_array = Array(X_array.length, X_array.value_type)
    X_median = compute_median(X_array)
    X_abs_diff = compute_abs_diff_value(X_array, X_median)
    X_abs_median = compute_median(X_abs_diff)
    
    @for_range(start=0,stop=X_array.length,step=1)
    def _(i):
        score_array[i] = (X_array[i] - X_median)/(X_abs_median)
    return score_array

    
# actual script


my_array = [1.2, 4.5, 10.5, 3.2, 30.12, 12.33, 11.3]


losses = Array(len(my_array),sfix)
losses.assign(my_array)


mad_scores = MAD_Score(losses)

print_ln("Losses %s", losses.reveal_list())
print_ln("Mad Scores %s", mad_scores.reveal_list())

