---
first_exp:
  n_repetitions: 1
  host_types:
    hserv1:
      n: 1
      check_status: True
      init_roles:
        - ml-example-setup-1
        - setup-poetry
      $CMD$:
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 0 2.0"
        
  base_experiment:
    mpc:
      player_count: 1
      player_0_hostname: "[% exp_host_lst | json_query(\"[?host_type=='hserv1'].private_dns_name\") | first %]"
      abs_path_to_code_dir: "{{exp_code_dir}}"
      script_name: "test_output_utils"
      script_args:
        - 10_000
        - 20_000
      protocol_setup: "emulate_env"
      input_file_name: "mnist-audit-conv-10epoch.zip"

test_protocol_integrations:
  n_repetitions: 1
  host_types:
    hserv1:
      n: 1
      check_status: True
      init_roles:
        - ml-example-setup-1
        - setup-poetry
      $CMD$:
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 0 2.0"

    hserv2:
      n: 2
      check_status: True
      init_roles:
        - ml-example-setup-1
        - setup-poetry
      $CMD$:
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 1 2.0"
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 2 2.0"
  base_experiment:
    mpc:
      player_count: 3
      player_0_hostname: "[% exp_host_lst | json_query(\"[?host_type=='hserv1'].private_dns_name\") | first %]"
      abs_path_to_code_dir: "{{exp_code_dir}}"
      script_name: "test_output_utils"
      script_args:
        - 10_000
        - 20_000
      protocol_setup:
        $FACTOR$: [
          "malicious_3_party",
          "semi_honest_bin_3",
          "malicious_bin_3"
        ]
      input_file_name: "mnist-audit-conv-10epoch.zip"


test_protocol_integrations_2:
  n_repetitions: 1
  host_types:
    hserv1:
      n: 1
      check_status: True
      init_roles:
        - ml-example-setup-1
        - setup-poetry
      $CMD$:
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 0 2.0"

    hserv2:
      n: 4
      check_status: True
      init_roles:
        - ml-example-setup-1
        - setup-poetry
      $CMD$:
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 1 2.0"
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 2 2.0"
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 3 2.0"
        - "bash {{exp_code_dir}}/utils/experiment-runner.sh \"{{exp_code_dir}}\" 4 2.0"
  base_experiment:
    mpc:
      player_count: 5
      player_0_hostname: "[% exp_host_lst | json_query(\"[?host_type=='hserv1'].private_dns_name\") | first %]"
      abs_path_to_code_dir: "{{exp_code_dir}}"
      script_name: "test_output_utils"
      script_args:
        - 10_000
        - 20_000
      protocol_setup:
        $FACTOR$: [
          "shamir_semi_honest_n",
          "shamir_malicious_n"
        ]
      input_file_name: "mnist-audit-conv-10epoch.zip"



$ETL$:
  test_etl_results:
    experiments: [first_exp]
    extractors:
      MpSpdzStderrExtractor:  {}
      MpSpdzResultExtractor: {}
      IgnoreExtractor: {}
    transformers:
      - name: "MpSpdzRowMergerTransformer"
        groupby_colums:
          - 'player_number'
          - 'thread_number'
        apply_columns:
          decision:
            column_name: 'decision'
            func: 'first'
          decision2:
            column_name: 'decision'
            func: 'set_f'

    loaders:
      CsvSummaryLoader:
        output_dir: etl_results/first_exp_results